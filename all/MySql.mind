{"root":{"data":{"id":"d8rxdc8h1sg0","created":1743167678294,"text":"MySql","progress":null,"expandState":"expand"},"children":[{"data":{"id":"d8rxdns47k00","created":1743167703427,"text":"事务","expandState":"expand","layout":null,"layout_right_offset":{"x":-227,"y":0}},"children":[{"data":{"id":"d8rxdqtf3x40","created":1743167710036,"text":"事务特性","expandState":"expand","layout":null,"image":"","imageTitle":"","imageSize":""},"children":[{"data":{"id":"d8rxe2pctf40","created":1743167735912,"text":"原子性(atomicty)","expandState":"expand","layout":null},"children":[{"data":{"id":"d8rxjix5wlk0","created":1743168163033,"text":"要么全部成功,要么全部失败","layout":null},"children":[]},{"data":{"id":"d8rxjp44onc0","created":1743168176515,"text":"每次进行操作时都会记录undolog,对操作进行一个相反的操作","layout":null},"children":[]}]},{"data":{"id":"d8rxdxwmwew0","created":1743167725468,"text":"一致性(consistency)","expandState":"expand","layout":null},"children":[]},{"data":{"id":"d8rxe4wlyao0","created":1743167740704,"text":"隔离性(isolation)","expandState":"expand","layout":null,"layout_right_offset":{"x":7,"y":27}},"children":[{"data":{"id":"d8ryopisowo0","created":1743171390332,"text":"隔离级别","expandState":"expand","layout":null},"children":[{"data":{"id":"d8rxg5y4lq80","created":1743167899701,"text":"读未提交(RU)","expandState":"expand","layout":null},"children":[{"data":{"id":"d8thl5scqo00","created":1743326273327,"text":"脏读"},"children":[{"data":{"id":"d8thmjwkeg80","created":1743326382421,"text":"读到其他事务没有提交的数据"},"children":[]}]}]},{"data":{"id":"d8rxgdbi2t40","created":1743167915747,"text":"读提交(RC)","expandState":"expand","layout":null},"children":[{"data":{"id":"d8thldmibnc0","created":1743326290388,"text":"不可重复读"},"children":[{"data":{"id":"d8thmrulw4g0","created":1743326399717,"text":"一个事务内的多次查询的数据不一样,其他事务提交的数据"},"children":[]}]}]},{"data":{"id":"d8rxgsyfsww0","created":1743167949785,"text":"可重复读(RR)","expandState":"expand","layout":null},"children":[{"data":{"id":"d8thm0yr1uo0","created":1743326341194,"text":"幻读"},"children":[{"data":{"id":"d8thnc4sbyg0","created":1743326443868,"text":"一个事务多次查询表数据时,查询的数据不一致,其他事务插入了数据","layout_right_offset":{"x":-9,"y":1},"priority":"1"},"children":[]}]}]},{"data":{"id":"d8rxgup4b200","created":1743167953575,"text":"串行化(S)","expandState":"expand","layout":null},"children":[{"data":{"id":"d8thm53aczc0","created":1743326350176,"text":"效率低下,阻塞并发事务"},"children":[]}]}]},{"data":{"id":"d8sgfmled7s0","created":1743221458660,"text":"解决方案","expandState":"expand","layout":null},"children":[{"data":{"id":"d8rxj4ixe6w0","created":1743168131697,"text":"MVCC多版本并发控制","layout":null,"note":"Multi-Version Concurrency Control "},"children":[{"data":{"id":"d8sgfzt3ruo0","created":1743221487424,"text":"版本链","layout":null,"expandState":"expand"},"children":[{"data":{"id":"d8th2gzh51s0","created":1743324808783,"text":"包含三个隐藏字段"},"children":[{"data":{"id":"d8th5ffhpj40","created":1743325040491,"text":"DB_TRX_ID（6字节）：最后修改该行的事务ID"},"children":[]},{"data":{"id":"d8th2jrfiko0","created":1743324814827,"text":"DB_ROLL_PTR（7字节）：回滚指针，指向Undo Log记录"},"children":[]},{"data":{"id":"d8th5p8oc740","created":1743325061846,"text":"DB_ROW_ID（6字节）：行ID（无主键时自动生成）"},"children":[]}]},{"data":{"id":"d8tdmom7mq00","created":1743315108239,"text":"","expandState":"expand"},"children":[]}]},{"data":{"id":"d8sgg4e1v340","created":1743221497398,"text":"readview","layout":null,"expandState":"expand"},"children":[{"data":{"id":"d8tgmoxab080","created":1743323572238,"text":"是基于undo log版本链条实现的一套读视图机制"},"children":[]},{"data":{"id":"d8tglmr2mz40","created":1743323489145,"text":"参数","note":"#### 可见性判断算法\n\n判断一行数据是否对当前事务可见的完整流程：\n\n1. **检查行记录的 DB_TRX_ID**：\n   - 如果 DB_TRX_ID == 当前事务ID → 可见（是自己修改的）\n   - 如果 DB_TRX_ID < m_up_limit_id → 可见（事务已提交）\n   - 如果 DB_TRX_ID >= m_low_limit_id → 不可见（事务在ReadView之后开始）\n2. **检查活跃事务列表**：\n   - 如果 DB_TRX_ID 在 m_ids 中 → 不可见（事务未提交）\n   - 否则 → 可见（事务已提交）\n3. **版本链回溯**：\n   - 如果不可见，通过 DB_ROLL_PTR 找到 Undo Log 中的旧版本\n   - 重复上述判断直到找到可见版本或到达链尾","progress":null,"priority":5},"children":[{"data":{"id":"d8tglqeybnk0","created":1743323497119,"text":"m_ids：生成ReadView时的活跃事务列表"},"children":[]},{"data":{"id":"d8tglrjfpe00","created":1743323499567,"text":"m_up_limit_id：活跃事务中最小的事务ID"},"children":[]},{"data":{"id":"d8tgm2gl0c80","created":1743323523339,"text":"m_low_limit_id：系统应该分配给下一个事务的ID"},"children":[]},{"data":{"id":"d8th6d07h400","created":1743325113577,"text":"m_creator_trx_id：创建该ReadView的事务ID"},"children":[]}]},{"data":{"id":"d8tgh446z3k0","created":1743323135123,"text":"在RC隔离级别下每次查询语句都会生成readview,所以会产生读取到其他事务提交的数据"},"children":[]},{"data":{"id":"d8tgi8m9l6w0","created":1743323223287,"text":"在RR隔离级别下,一个事务只有在第一次查询操作时会产生readview,保证在同一事务内数据一致性","expandState":"expand"},"children":[]}]}]}]}]},{"data":{"id":"d8rxeho2qhc0","created":1743167768486,"text":"持久性(durability)","expandState":"expand","layout":null,"layout_right_offset":{"x":-4,"y":3}},"children":[{"data":{"id":"d8rypxasl200","created":1743171485627,"text":"实现方式","layout":null},"children":[{"data":{"id":"d8rytzmxgkg0","created":1743171804171,"text":"redolog和undolog","layout":null},"children":[]},{"data":{"id":"d8rypze27kw0","created":1743171490178,"text":"二阶段提交","layout":null},"children":[]}]}]}]},{"data":{"id":"d8tgfxqo2ts0","created":1743323042880,"text":"innoDB引擎可以设置字段"},"children":[{"data":{"id":"d8tggfe54ko0","created":1743323081305,"text":"AutoCommit"},"children":[]}]}]},{"data":{"id":"d8sggetii0w0","created":1743221520101,"text":"索引","note":null,"layout_mind_offset":{"x":2,"y":-2},"layout":null},"children":[{"data":{"id":"d8sgtzmrk8o0","created":1743222584139,"text":"底层","layout":null},"children":[{"data":{"id":"d8sgu24th6o0","created":1743222589585,"text":"B树","layout":null},"children":[]},{"data":{"id":"d8sgu4j8ivk0","created":1743222594810,"text":"B+树","layout":null},"children":[]}]},{"data":{"id":"d8sk1wwiocw0","created":1743231668442,"text":"索引类型"},"children":[{"data":{"id":"d8sk21p85400","created":1743231678885,"text":"物理索引","note":"mysql的innodb存储引擎\n数据存放在索引的叶子节点上这就是聚集索引 Clustered Index\n而myisam存储引擎\n他的索引的叶子节点存放的时数据和地址\n数据和索引不存放在一起,这就是非聚集索引 Non-Clustered Index\n"},"children":[{"data":{"id":"d8sk256qcps0","created":1743231686474,"text":"聚集索引","note":null},"children":[]},{"data":{"id":"d8sk274k3340","created":1743231690696,"text":"非聚集索引"},"children":[]}]},{"data":{"id":"d8sk86aosy80","created":1743232159075,"text":""},"children":[]}]}]},{"data":{"id":"d8sgw91yufk0","created":1743222761378,"text":"InnoDB","layout":null,"expandState":"expand"},"children":[{"data":{"id":"d8sh76dh5eo0","created":1743223617549,"text":"页为单位存储数据","layout":null},"children":[]}]},{"data":{"id":"d8sh9jigib40","created":1743223802877,"text":"分布式主键","layout":null},"children":[{"data":{"id":"d8shb8l4zls0","created":1743223935823,"text":"雪花算法","layout":null},"children":[{"data":{"id":"d8shbcmd4pc0","created":1743223944604,"text":"始终回拨","layout":null},"children":[]}]}]},{"data":{"id":"d8shdux39ww0","created":1743224141163,"text":"日志文件","layout":null},"children":[{"data":{"id":"d8shdzrplqw0","created":1743224151722,"text":"slowlog","layout":null},"children":[{"data":{"id":"d8she50r0vc0","created":1743224163152,"text":"慢sql日志","layout":null},"children":[]}]},{"data":{"id":"d8she9bgjn40","created":1743224172507,"text":"binlog","layout":null},"children":[{"data":{"id":"d8shec1mqcg0","created":1743224178443,"text":"主从同步","layout":null},"children":[{"data":{"id":"d8shgeu1dk00","created":1743224341242,"text":"执行数据库写造成","layout":null},"children":[]},{"data":{"id":"d8shhk0yvts0","created":1743224430910,"text":"主从复制","layout":null},"children":[]},{"data":{"id":"d8shhmlzp3k0","created":1743224436534,"text":"数据恢复","layout":null},"children":[]}]},{"data":{"id":"d8shhv1l2e80","created":1743224454892,"text":"刷盘机制","layout":null},"children":[]}]},{"data":{"id":"d8shezes0qo0","created":1743224229304,"text":"errorlog","layout":null},"children":[{"data":{"id":"d8shf4zobhc0","created":1743224241451,"text":"错误日志","layout":null},"children":[]}]},{"data":{"id":"d8shf9g2i5k0","created":1743224251150,"text":"relaylog","layout":null},"children":[{"data":{"id":"d8shfgac0zk0","created":1743224266040,"text":"从节点暂存主节点同步过来的binlog数据","layout":null},"children":[]}]},{"data":{"id":"d8shfufootk0","created":1743224296839,"text":"undolog","layout":null},"children":[{"data":{"id":"d8shfzjb6g80","created":1743224307942,"text":"回滚日志","layout":null},"children":[]}]},{"data":{"id":"d8shfxbnto80","created":1743224303126,"text":"redolog","layout":null},"children":[{"data":{"id":"d8shg1my1hc0","created":1743224312515,"text":"前滚日志","layout":null},"children":[]}]}]}]},"template":"right","theme":"fresh-blue","version":"1.4.43"}